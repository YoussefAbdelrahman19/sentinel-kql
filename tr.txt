
Comprehensive Guide to Handling “Suspicious Process Injection” Alerts and Automating Response in Microsoft Sentinel
Version: 2025-10-09 (Europe/Budapest)

Executive Summary
This guide provides a production-grade, audit-friendly workflow to (1) surface Defender “Suspicious process injection observed” alerts inside Microsoft Sentinel, (2) triage them at scale with high confidence so that benign/expected cases are automatically closed, and (3) escalate truly risky cases for investigation. It assumes you are operating in a fully authorized environment.
https://chatgpt.com/share/68ecf4f1-e1ac-8010-bc9f-12086db6d001
Authoritative References (key load-bearing sources)
- Microsoft Learn – Automation rules: suppress noisy incidents, close incidents with reasons, trigger playbooks (Oct 16, 2024): https://learn.microsoft.com/en-us/azure/sentinel/automate-incident-handling-with-automation-rules
- Microsoft Learn – Handle false positives (Feb 13, 2025): https://learn.microsoft.com/en-us/azure/sentinel/false-positives
- Microsoft Learn – Create/use automation rules (Nov 19, 2024): https://learn.microsoft.com/en-us/azure/sentinel/create-manage-use-automation-rules
- Microsoft Defender portal incidents overview (Jan 6, 2025): https://learn.microsoft.com/en-us/defender-xdr/incidents-overview
- Automation Rules REST API (Sep 1, 2025): https://learn.microsoft.com/en-us/rest/api/securityinsights/automation-rules/list?view=rest-securityinsights-2025-09-01
- MITRE ATT&CK T1055 Process Injection: https://attack.mitre.org/techniques/T1055/
- Red Canary – Process Injection technique & detections (2025 report set): https://redcanary.com/threat-detection-report/techniques/process-injection/ and https://redcanary.com/blog/t

https://chatgpt.com/share/691a5306-ba3c-8010-9207-f7c5b49d03e5


let exclude_Maintainance_Devices = _GetWatchlist('OMV_LS_Maint')
    | summarize by Device;

let alert_list = SecurityIncident
    | mv-expand AlertIds
    | extend AlertIds = tostring(AlertIds)
    | join kind=inner SecurityAlert on $left.AlertIds == $right.SystemAlertId
    | project CustomDetails = parse_json(ExtendedProperties)["Custom Details"]
    | where CustomDetails has "alertId"
    | extend alert_ids_LA = parse_json(tostring(CustomDetails))["alertId_s"]
    | where isnotempty(alert_ids_LA)
    | project alert_ids_LA
    | distinct alert_ids_LA;

// الحل الأساسي: استبعاد الأجهزة اللي طلع لها alerts في آخر 72 ساعة
let Recently_Alerted_Devices = 
    Alert_Triggered_CommonSecurityLog_CL
    | where TimeGenerated > ago(72h)
    | where alertName_s has "is not reporting more than threshold"
    | summarize LastAlertTime = max(TimeGenerated) by Device_s, DeviceVendor_s
    | project Device_s;

// Main Query
Alert_Triggered_CommonSecurityLog_CL
| where alertName_s has "is not reporting more than threshold"
| where isnotempty(alertId_s)
| where isnotempty(Device_s)
| where alertId_s !in (alert_list)
| where Device_s !in (Recently_Alerted_Devices)
| where Device_s !in (exclude_Maintainance_Devices)







let exclude_Maintainance_Devices = _GetWatchlist('OMV_LS_Maint')
    | summarize by Device;

let alert_list = SecurityIncident
    | mv-expand AlertIds
    | extend AlertIds = tostring(AlertIds)
    | join kind=inner SecurityAlert on $left.AlertIds == $right.SystemAlertId
    | project CustomDetails = parse_json(ExtendedProperties)["Custom Details"]
    | where CustomDetails has "alertId"
    | extend alert_ids_LA = parse_json(tostring(CustomDetails))["alertId_s"]
    | where isnotempty(alert_ids_LA)
    | project alert_ids_LA
    | distinct alert_ids_LA;

// استبعاد مزدوج: الأجهزة + الـ AlertIds
let Recently_Alerted_Devices = 
    Alert_Triggered_CommonSecurityLog_CL
    | where TimeGenerated > ago(72h)
    | where alertName_s has "is not reporting more than threshold"
    | summarize 
        LastAlertTime = max(TimeGenerated),
        AlertCount = count()
    by Device_s, DeviceVendor_s
    | project Device_s;

let Recently_Alerted_IDs = 
    Alert_Triggered_CommonSecurityLog_CL
    | where TimeGenerated > ago(72h)
    | where alertName_s has "is not reporting more than threshold"
    | where isnotempty(alertId_s)
    | distinct alertId_s;

// Main Query
Alert_Triggered_CommonSecurityLog_CL
| where alertName_s has "is not reporting more than threshold"
| where isnotempty(alertId_s)
| where isnotempty(Device_s)
| where alertId_s !in (alert_list)
| where alertId_s !in (Recently_Alerted_IDs)
| where Device_s !in (Recently_Alerted_Devices)
| where Device_s !in (exclude_Maintainance_Devices) 	




let exclude_Maintainance_Devices = _GetWatchlist('OMV_LS_Maint')
    | summarize by Device;

let alert_list = SecurityIncident
    | mv-expand AlertIds
    | extend AlertIds = tostring(AlertIds)
    | join kind=inner SecurityAlert on $left.AlertIds == $right.SystemAlertId
    | project CustomDetails = parse_json(ExtendedProperties)["Custom Details"]
    | where CustomDetails has "alertId"
    | extend alert_ids_LA = parse_json(tostring(CustomDetails))["alertId_s"]
    | where isnotempty(alert_ids_LA)
    | project alert_ids_LA
    | distinct alert_ids_LA;

// آخر مرة كل جهاز طلع له alert
let Device_Last_Alert_Time = 
    Alert_Triggered_CommonSecurityLog_CL
    | where TimeGenerated > ago(72h)
    | where alertName_s has "is not reporting more than threshold"
    | where isnotempty(Device_s)
    | summarize LastAlertTime = max(TimeGenerated) by Device_s;

// Main Query
Alert_Triggered_CommonSecurityLog_CL
| where alertName_s has "is not reporting more than threshold"
| where isnotempty(alertId_s)
| where isnotempty(Device_s)
| where alertId_s !in (alert_list)
| where Device_s !in (exclude_Maintainance_Devices)
| join kind=leftouter Device_Last_Alert_Time on Device_s
| where isnull(LastAlertTime) or datetime_diff('hour', now(), LastAlertTime) >= 72
| project-away LastAlertTime








let exclude_Maintainance_Devices = _GetWatchlist('OMV_LS_Maint')
    | summarize by Device;

let alert_list = SecurityIncident
    | mv-expand AlertIds
    | extend AlertIds = tostring(AlertIds)
    | join kind=inner SecurityAlert on $left.AlertIds == $right.SystemAlertId
    | project CustomDetails = parse_json(ExtendedProperties)["Custom Details"]
    | where CustomDetails has "alertId"
    | extend alert_ids_LA = tostring(parse_json(tostring(CustomDetails))["alertId_s"])  // ✅ تحويل لـ string
    | where isnotempty(alert_ids_LA)
    | distinct alert_ids_LA;  // ✅ دلوقتي هيشتغل

// آخر مرة كل جهاز طلع له alert
let Device_Last_Alert_Time = 
    Alert_Triggered_CommonSecurityLog_CL
    | where TimeGenerated > ago(72h)
    | where alertName_s has "is not reporting more than threshold"
    | where isnotempty(Device_s)
    | summarize LastAlertTime = max(TimeGenerated) by Device_s;

// Main Query
Alert_Triggered_CommonSecurityLog_CL
| where alertName_s has "is not reporting more than threshold"
| where isnotempty(alertId_s)
| where isnotempty(Device_s)
| where alertId_s !in (alert_list)
| where Device_s !in (exclude_Maintainance_Devices)
| join kind=leftouter Device_Last_Alert_Time on Device_s
| where isnull(LastAlertTime) or datetime_diff('hour', now(), LastAlertTime) >= 72
| project-away LastAlertTime
